import java.util.*;

public class RailFenceCipher {

    // Encryption
    public static String encrypt(String text, int rails) {
        if (rails <= 1) {
            throw new IllegalArgumentException(" Rail number must be greater than 1 for proper encryption.");
        }

        List<StringBuilder> rail = new ArrayList<>();
        for (int i = 0; i < rails; i++) {
            rail.add(new StringBuilder());
        }

        int row = 0, dir = 1;
        for (char c : text.toCharArray()) {
            rail.get(row).append(c);
            if (row == 0) dir = 1;
            else if (row == rails - 1) dir = -1;
            row += dir;
        }

        StringBuilder result = new StringBuilder();
        for (StringBuilder sb : rail) result.append(sb);
        return result.toString();
    }

    // Decryption
    public static String decrypt(String cipher, int rails) {
        if (rails <= 1) {
            throw new IllegalArgumentException("Rail number must be greater than 1 for proper decryption.");
        }

        int len = cipher.length();
        int[] railLen = new int[rails];
        int row = 0, dir = 1;

        // Count number of characters per rail
        for (int i = 0; i < len; i++) {
            railLen[row]++;
            if (row == 0) dir = 1;
            else if (row == rails - 1) dir = -1;
            row += dir;
        }

        List<String> railsData = new ArrayList<>();
        int index = 0;
        for (int lenPart : railLen) {
            railsData.add(cipher.substring(index, index + lenPart));
            index += lenPart;
        }

        int[] pos = new int[rails];
        row = 0;
        dir = 1;
        StringBuilder result = new StringBuilder();

        for (int i = 0; i < len; i++) {
            result.append(railsData.get(row).charAt(pos[row]++));
            if (row == 0) dir = 1;
            else if (row == rails - 1) dir = -1;
            row += dir;
        }
        return result.toString();
    }

    // Main Program
    public static void main(String[] args) {
        Scanner sc = new Scanner(System.in);
        System.out.println("NOTE: While entering rail number for Rail Fence cipher please enter integer value only");

        System.out.print("Enter text to encrypt: ");
        String text = sc.nextLine();

        // Text validation
        while (text.trim().isEmpty()) {
            System.out.print(" Text cannot be empty. Please enter valid text: ");
            text = sc.nextLine();
        }

        int rails = 0;
        boolean validRails = false;

        //  Validate rail number input
        while (!validRails) {
            System.out.print("Enter no. of Rails : ");
            String input = sc.next();

            try {
                rails = Integer.parseInt(input);
                if (rails <= 1) {
                    System.out.println(" Invalid rail number! It must be greater than 1.");
                } else if (rails > text.length()) {
                    System.out.println(" Invalid rail number! It must not be greater than the text length (" + text.length() + ").");
                } else {
                    validRails = true;
                }
            } catch (NumberFormatException e) {
                System.out.println(" Invalid input! Please enter a valid integer for the rail number.");
            }
        }

        System.out.println("Original text: " + text);
        String encrypted = encrypt(text, rails);
        System.out.println("Encrypted text: " + encrypted);

        String decrypted = decrypt(encrypted, rails);
        System.out.println("Decrypted text: " + decrypted);

        sc.close();
    }
}
